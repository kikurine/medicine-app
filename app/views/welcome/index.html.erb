<div style="max-width: 500px; margin: 0 auto; font-family: sans-serif;">
  <h1 style="text-align: center;">💊 服薬管理</h1>

  <% if notice %>
    <p style="background: #e6fffa; color: #2d3748; padding: 10px; border-radius: 5px; border: 1px solid #38b2ac;"><%= notice %></p>
  <% end %>

  <% @medicines.each do |medicine| %>
    <div style="border: 2px solid #2d3748; padding: 20px; border-radius: 15px; margin-bottom: 20px;
                <%= (medicine.take_today? && !medicine.taken_today?) ? 'background-color: #fff5f5; border-color: #f56565;' : 'background-color: #f7fafc;' %>">
      
      <h2 style="margin-top: 0;"><%= medicine.name %></h2>

      <% if medicine.taken_today? %>
        <p style="color: #38a169; font-weight: bold; font-size: 1.2em;">✅ 今日は服用済みです</p>
      <% elsif medicine.take_today? %>
        <p style="color: #e53e3e; font-weight: bold; font-size: 1.2em;">⚠️ 今日は【飲む日】です！</p>
        <%= button_to "飲んだ！", record_dose_path(id: medicine.id), method: :post, 
            style: "background: #48bb78; color: white; border: none; padding: 12px 24px; border-radius: 10px; font-size: 1.1em; cursor: pointer; width: 100%;" %>
      <% else %>
        <p style="color: #718096;">今日はお休みです。</p>
      <% end %>

      <div style="margin-top: 20px; border-top: 1px solid #cbd5e0; padding-top: 10px;">
        <h4 style="margin-bottom: 5px;">最近の履歴</h4>
        <ul style="font-size: 0.9em; color: #4a5568; padding-left: 20px;">
          <% medicine.dose_records.order(created_at: :desc).limit(3).each do |record| %>
            <li><%= record.created_at.strftime("%m/%d %H:%M") %> に服用</li>
          <% end %>
          <% if medicine.dose_records.empty? %>
            <li style="list-style: none; margin-left: -20px;">まだ記録がありません</li>
          <% end %>
        </ul>
      </div>
    </div>
  <% end %>
</div>